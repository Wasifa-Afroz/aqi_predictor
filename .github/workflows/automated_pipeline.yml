name: AQI Prediction Pipeline

on:
  # Manual trigger only
  workflow_dispatch:
    inputs:
      pipeline_type:
        description: 'Which pipeline to run?'
        required: true
        default: 'both'
        type: choice
        options:
          - feature
          - training
          - both

jobs:
  run-pipeline:
    name: Run AQI Pipeline
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy scikit-learn xgboost lightgbm pymongo dnspython requests python-dotenv matplotlib seaborn plotly shap streamlit joblib
      
      - name: Run Feature Pipeline
        if: github.event.inputs.pipeline_type == 'feature' || github.event.inputs.pipeline_type == 'both'
        env:
          OPENWEATHER_API_KEY: ${{ secrets.OPENWEATHER_API_KEY }}
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
          MONGODB_DB_NAME: ${{ secrets.MONGODB_DB_NAME }}
        run: |
          python src/feature_pipeline.py
      
      - name: Run Training Pipeline
        if: github.event.inputs.pipeline_type == 'training' || github.event.inputs.pipeline_type == 'both'
        env:
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
          MONGODB_DB_NAME: ${{ secrets.MONGODB_DB_NAME }}
        run: |
          python src/training_pipeline.py
      
      - name: Show completion message
        run: |
          echo "âœ… Pipeline completed successfully!"